const fs = require('fs');
const { dirname } = require('path');
const { promisify } = require('util');
const globCb = require('glob');
const mkdirpCb = require('mkdirp');

const SVGO = require('svgo');

const readFile = promisify(fs.readFile);
const writeFile = promisify(fs.writeFile);
const glob = promisify(globCb);
const mkdirp = promisify(mkdirpCb);
const svgo = new SVGO({
  plugins: [{
    collapseGroups: false,
  }]
});

async function process() {
  const files = await glob('src/**/*.svg');

  files.forEach(async (filePath) => {
    const outputFilePath = filePath.replace(/^src\//, 'lib/');
    const fileContent = await readFile(filePath, 'utf8');
    const { data } = await svgo.optimize(fileContent, {path: filePath});

    await mkdirp(dirname(outputFilePath));
    await writeFile(outputFilePath, data, 'utf8');
  });
}

process();
